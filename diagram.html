<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Housing-Data ER Diagram</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
<style>
/* ---------- Design tokens ---------- */
:root{
  /* light theme */
  --bg       : #f9fafc;
  --text     : #0f172a;
  --surface  : #ffffff;
  --accent   : #3b82f6;
  --border   : #cbd5e1;

  /* entity colours */
  --core-bg  : #e0f2fe; --core-stroke  : #0284c7; --core-text  : #075985;
  --people-bg: #dbeafe; --people-stroke: #2563eb; --people-text: #1e40af;
  --inc-bg   : #fee2e2; --inc-stroke   : #dc2626; --inc-text   : #7f1d1d;
  --misc-bg  : #ecfccb; --misc-stroke  : #65a30d; --misc-text  : #365314;

  /* dark theme overrides (applied via .dark on <html>) */
  --bg-dark       : #0f172a;
  --text-dark     : #f1f5f9;
  --surface-dark  : #1e293b;
  --border-dark   : #475569;
}
html{color-scheme:light dark;font-family:"Inter",system-ui,sans-serif}

/* ---------- Layout & typography ---------- */
*{box-sizing:border-box}
body{
  margin:0;display:flex;flex-direction:column;min-height:100vh;
  background:var(--bg);color:var(--text);transition:background .3s,color .3s
}
html.dark body{background:var(--bg-dark);color:var(--text-dark)}
header{
  padding:1.25rem 1rem;
  background:linear-gradient(135deg,var(--accent),#60a5fa);
  color:#fff;text-align:center;box-shadow:0 2px 8px rgb(0 0 0 /.08)
}
h1{margin:0;font-size:clamp(1.4rem,2vw+1rem,2.4rem);font-weight:600}

#controls{
  display:flex;flex-wrap:wrap;gap:.75rem;justify-content:center;
  padding:1rem 0 .25rem
}
button{
  cursor:pointer;border:none;border-radius:6px;font-weight:600;
  padding:.55rem 1rem;display:inline-flex;align-items:center;gap:.4rem;
  transition:background .2s,transform .15s
}
button:active{transform:scale(.97)}
.btn-primary{background:var(--accent);color:#fff}
.btn-secondary{
  background:var(--surface);color:var(--text);border:1px solid var(--border)}
html.dark .btn-secondary{
  background:var(--surface-dark);color:var(--text-dark);border:1px solid var(--border-dark)}

#legend{
  max-width:270px;margin:0 auto 1rem;
  border:1px solid var(--border);border-radius:8px;overflow:hidden;
  background:var(--surface)
}
html.dark #legend{border-color:var(--border-dark);background:var(--surface-dark)}
.legend-row{display:flex;align-items:center;padding:.5rem .75rem;font-size:.9rem}
.swatch{flex:0 0 18px;height:18px;border-radius:4px;margin-right:.6rem}

#diagram-wrapper{
  flex:1;overflow:hidden;padding:0 1rem 1.5rem;
  display:flex;justify-content:center
}
svg{max-width:2000px;width:100%;height:auto}

/* ---------- SVG reusable styles ---------- */
svg .box{rx:8;ry:8;width:155;height:56}
svg text{font:600 14px/1.2 "Inter",sans-serif;dominant-baseline:middle;text-anchor:middle}
svg .lbl{font:italic 12px/1 "Inter",sans-serif;fill:var(--text)}
html.dark svg .lbl{fill:var(--text-dark)}
</style>
</head>
<body>
<header><h1>Housing Data – ER Diagram</h1></header>

<!-- controls -->
<div id="controls">
  <button id="toggleTheme" class="btn-primary"><span id="themeLabel">Dark Mode</span></button>
  <button id="downloadSvg" class="btn-secondary">Download SVG</button>
  <button id="resetZoom"   class="btn-secondary">Reset Zoom</button>
</div>

<!-- legend -->
<div id="legend">
  <div class="legend-row"><span class="swatch" style="background:var(--core-bg);border:1px solid var(--core-stroke)"></span>Core Entities</div>
  <div class="legend-row"><span class="swatch" style="background:var(--people-bg);border:1px solid var(--people-stroke)"></span>People / Finance</div>
  <div class="legend-row"><span class="swatch" style="background:var(--inc-bg);border:1px solid var(--inc-stroke)"></span>Incidents &amp; Maintenance</div>
  <div class="legend-row"><span class="swatch" style="background:var(--misc-bg);border:1px solid var(--misc-stroke)"></span>Other / Misc</div>
</div>

<!-- diagram -->
<div id="diagram-wrapper">
  <svg id="diagram" viewBox="0 0 850 880" xmlns="http://www.w3.org/2000/svg">
    <defs>
      <!-- arrowhead -->
      <marker id="arrow" markerWidth="12" markerHeight="12" refX="10" refY="3.5" orient="auto" markerUnits="strokeWidth">
        <path d="M0,0 L10,3.5 L0,7 Z" fill="currentColor"/>
      </marker>
      <!-- drop shadow -->
      <filter id="ds" height="150%">
        <feDropShadow dx="0" dy="2" stdDeviation="2" flood-opacity=".12"/>
      </filter>
    </defs>

    <!-- ========= boxes ========= -->
    <!-- row 0 -->
    <rect x="347" y="20"   class="box core"   style="filter:url(#ds);fill:var(--core-bg);stroke:var(--core-stroke)"/>
    <text x="425" y="48" fill="var(--core-text)">ESTATE</text>

    <!-- row 1 -->
    <rect x="347" y="130"  class="box core"   style="filter:url(#ds);fill:var(--core-bg);stroke:var(--core-stroke)"/>
    <text x="425" y="158" fill="var(--core-text)">BLOCK</text>

    <!-- row 2 -->
    <rect x="347" y="285"  class="box core"   style="filter:url(#ds);fill:var(--core-bg);stroke:var(--core-stroke)"/>
    <text x="425" y="313" fill="var(--core-text)">PROPERTY</text>

    <rect x="80"  y="285"  class="box core"   style="filter:url(#ds);fill:var(--core-bg);stroke:var(--core-stroke)"/>
    <text x="158" y="313" fill="var(--core-text)">TENANT</text>

    <!-- incidents / maintenance (row 2 shifted right) -->
    <g style="filter:url(#ds)">
      <rect x="600" y="190" class="box inc" style="fill:var(--inc-bg);stroke:var(--inc-stroke)"/>
      <rect x="600" y="300" class="box inc" style="fill:var(--inc-bg);stroke:var(--inc-stroke)"/>
      <rect x="600" y="410" class="box inc" style="fill:var(--inc-bg);stroke:var(--inc-stroke)"/>
    </g>
    <text x="678" y="218" fill="var(--inc-text)">DAMP_INCIDENT</text>
    <text x="678" y="328" fill="var(--inc-text)">MAINT_REQUEST</text>
    <text x="678" y="438" fill="var(--inc-text)">INSPECTION</text>

    <!-- row 3 -->
    <rect x="347" y="510"  class="box misc" style="filter:url(#ds);fill:var(--misc-bg);stroke:var(--misc-stroke)"/>
    <text x="425" y="538" fill="var(--misc-text)">TENANCY_EVENT</text>

    <rect x="600" y="510"  class="box inc"  style="filter:url(#ds);fill:var(--inc-bg);stroke:var(--inc-stroke)"/>
    <text x="678" y="538" fill="var(--inc-text)">ASB_INCIDENT</text>

    <!-- row 4 -->
    <g style="filter:url(#ds)">
      <rect x="600" y="620" class="box misc" style="fill:var(--misc-bg);stroke:var(--misc-stroke)"/>
      <rect x="600" y="730" class="box misc" style="fill:var(--misc-bg);stroke:var(--misc-stroke)"/>
      <rect x="600" y="840" class="box misc" style="fill:var(--misc-bg);stroke:var(--misc-stroke)"/>
    </g>
    <text x="678" y="648" fill="var(--misc-text)">COMPLIANCE_RECORD</text>
    <text x="678" y="758" fill="var(--misc-text)">ENERGY_READING</text>
    <text x="678" y="868" fill="var(--misc-text)">IOT_SENSOR</text>

    <rect x="80"  y="205"  class="box misc" style="filter:url(#ds);fill:var(--misc-bg);stroke:var(--misc-stroke)"/>
    <text x="158" y="233" fill="var(--misc-text)">RENT_PAYMENT</text>
    <rect x="80"  y="365"  class="box misc" style="filter:url(#ds);fill:var(--misc-bg);stroke:var(--misc-stroke)"/>
    <text x="158" y="393" fill="var(--misc-text)">TENANT_FEEDBACK</text>

    <!-- ========= relationships ========= -->
    <!-- property ↔ tenant -->
    <path d="M347 312 H235" stroke="currentColor" marker-end="url(#arrow)"/>
    <text x="290" y="300" class="lbl">occupied by</text>

    <!-- property ↔ tenancy_event -->
    <path d="M425 341 V510" stroke="currentColor" marker-end="url(#arrow)"/>
    <text x="435" y="430" class="lbl">tenancy history</text>

    <!-- property ↔ block / block ↔ estate -->
    <path d="M425 285 V210" stroke="currentColor" marker-end="url(#arrow)"/>
    <text x="435" y="248" class="lbl">in block</text>
    <path d="M425 130 V70"  stroke="currentColor" marker-end="url(#arrow)"/>
    <text x="435" y="100" class="lbl">in estate</text>

    <!-- tenant → payments / feedback -->
    <path d="M158 285 V233" stroke="currentColor" marker-end="url(#arrow)"/>
    <text x="168" y="260" class="lbl">makes</text>
    <path d="M158 313 V365" stroke="currentColor" marker-end="url(#arrow)"/>
    <text x="168" y="335" class="lbl">gives</text>

    <!-- property → incidents / maint / inspect / ASB -->
    <path d="M502 313 H600" stroke="currentColor" marker-end="url(#arrow)"/>
    <text x="552" y="300" class="lbl">has</text>
    <path d="M502 323 H600" stroke="currentColor" marker-end="url(#arrow)"/>
    <text x="552" y="360" class="lbl">maintenance</text>
    <path d="M502 333 H600" stroke="currentColor" marker-end="url(#arrow)"/>
    <text x="552" y="390" class="lbl">inspected</text>
    <path d="M502 510 H600" stroke="currentColor" marker-end="url(#arrow)"/>
    <text x="552" y="500" class="lbl">ASB</text>

    <!-- property → compliance / energy / IoT -->
    <path d="M502 620 H600" stroke="currentColor" marker-end="url(#arrow)"/>
    <text x="552" y="610" class="lbl">compliance</text>
    <path d="M502 730 H600" stroke="currentColor" marker-end="url(#arrow)"/>
    <text x="552" y="720" class="lbl">energy usage</text>
    <path d="M502 840 H600" stroke="currentColor" marker-end="url(#arrow)"/>
    <text x="552" y="830" class="lbl">monitored by</text>
  </svg>
</div>

<!-- ========== JS ========== -->
<script type="module">
/* svg-pan-zoom (tiny ESM build) */
import svgPanZoom from 'https://cdn.jsdelivr.net/npm/svg-pan-zoom@3.6.1/dist/svg-pan-zoom.min.js';

const root   = document.documentElement;
const label  = document.getElementById('themeLabel');
let theme    = localStorage.getItem('er-theme') ||
               (matchMedia('(prefers-color-scheme:dark)').matches ? 'dark':'light');

function applyTheme(){
  root.classList.toggle('dark', theme==='dark');
  label.textContent = theme==='dark' ? 'Light Mode' : 'Dark Mode';
}
applyTheme();

/* pan-zoom */
const panZoom = svgPanZoom(document.getElementById('diagram'),{
  controlIconsEnabled:true,minZoom:0.35,maxZoom:6,zoomScaleSensitivity:.6
});
addEventListener('resize',()=>panZoom.resize());

/* buttons */
document.getElementById('toggleTheme').onclick = ()=>{
  theme = theme==='dark'?'light':'dark';
  localStorage.setItem('er-theme',theme);
  applyTheme();
};
document.getElementById('resetZoom').onclick = () => panZoom.resetZoom();
document.getElementById('downloadSvg').onclick = ()=>{
  const svg = document.getElementById('diagram').outerHTML;
  const blob = new Blob([svg],{type:'image/svg+xml;charset=utf-8'});
  const link = Object.assign(document.createElement('a'),{
    href:URL.createObjectURL(blob),download:'housing_er_diagram.svg'
  });
  link.click();
  URL.revokeObjectURL(link.href);
};
</script>
</body>
</html>
