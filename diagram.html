<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Housing-Data â€“ Interactive ER Network</title>
<meta name="viewport" content="width=device-width,initial-scale=1" />
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">

<!-- vis-network -->
<script src="https://unpkg.com/vis-network@9.1.7/dist/vis-network.min.js"></script>
<link  href="https://unpkg.com/vis-network@9.1.7/dist/vis-network.min.css" rel="stylesheet"/>

<style>
:root{
  --bg:#f8fafc;       --bg-dark:#0f172a;
  --surface:#ffffff;  --surface-dark:#1e293b;
  --text:#0f172a;     --text-dark:#e2e8f0;
  --accent:#2563eb;
  --core:#0ea5e9;     --people:#6366f1;   --inc:#ef4444; --misc:#65a30d;
}
*{box-sizing:border-box}
body{
  margin:0;font-family:"Inter",sans-serif;
  background:var(--bg);color:var(--text);display:flex;flex-direction:column;
  height:100vh;transition:background .3s,color .3s
}
body.dark{background:var(--bg-dark);color:var(--text-dark)}
header{
  padding:1rem .5rem;text-align:center;
  background:linear-gradient(135deg,var(--accent),#60a5fa);color:#fff;
  font-size:clamp(1.3rem,2vw+1rem,2.1rem);font-weight:600
}
#toolbar{
  display:flex;justify-content:center;gap:.75rem;flex-wrap:wrap;
  padding:.6rem 0;background:var(--surface);transition:background .3s;box-shadow:0 1px 4px rgb(0 0 0/.05)
}
body.dark #toolbar{background:var(--surface-dark)}
.btn{
  border:none;border-radius:6px;cursor:pointer;font-weight:600;
  padding:.45rem .9rem;display:flex;align-items:center;gap:.4rem;
  background:var(--accent);color:#fff;transition:transform .15s
}
.btn:active{transform:scale(.96)}
#network{flex:1 1 auto;min-height:0}          /* allow network to fill remaining height */
.legend{
  position:absolute;right:1rem;bottom:1rem;
  background:var(--surface);padding:.6rem;border-radius:8px;font-size:.85rem;
  box-shadow:0 2px 6px rgb(0 0 0/.08);transition:background .3s
}
body.dark .legend{background:var(--surface-dark)}
.legend-item{display:flex;align-items:center;margin:.2rem 0}
.swatch{width:14px;height:14px;border-radius:3px;margin-right:.4rem}
</style>
</head>
<body>
<header>Housing-Data Entity Relationship Network</header>

<div id="toolbar">
  <button id="themeBtn" class="btn">ðŸŒ™ Dark Mode</button>
  <button id="fitBtn"   class="btn" style="background:#6b7280">ï¿½ center</button>
  <button id="pngBtn"   class="btn" style="background:#10b981">â¬‡ PNG</button>
</div>

<div id="network"></div>

<!-- colour legend -->
<div class="legend" id="legend">
  <div class="legend-item"><span class="swatch" style="background:var(--core)"></span>Core</div>
  <div class="legend-item"><span class="swatch" style="background:var(--people)"></span>People/Finance</div>
  <div class="legend-item"><span class="swatch" style="background:var(--inc)"></span>Incidents&nbsp;&amp;&nbsp;Maintenance</div>
  <div class="legend-item"><span class="swatch" style="background:var(--misc)"></span>Misc</div>
</div>

<script>
/* ---------- Theme ---------- */
const prefersDark = window.matchMedia("(prefers-color-scheme: dark)").matches;
let dark = JSON.parse(localStorage.getItem("dark-theme") ?? prefersDark);
const setTheme = () => {
  document.body.classList.toggle("dark", dark);
  document.getElementById("themeBtn").textContent = dark ? "â˜€ Light Mode" : "ðŸŒ™ Dark Mode";
  localStorage.setItem("dark-theme", JSON.stringify(dark));
};
setTheme();
document.getElementById("themeBtn").onclick = () => { dark = !dark; setTheme(); };

/* ---------- Define nodes & edges ---------- */
const node = (id, label, group, title="") => ({ id, label, group, title });
const edge = (from, to, label) => ({ from, to, arrows:"to", label, font:{align:"middle"} });

const nodes = new vis.DataSet([
  /* core */
  node("ESTATE","ESTATE","core","Top-level estate"),
  node("BLOCK","BLOCK","core"),
  node("PROPERTY","PROPERTY","core"),
  node("TENANT","TENANT","core"),
  /* people / money */
  node("RENT_PAYMENT","RENT_PAYMENT","people"),
  node("TENANT_FEEDBACK","TENANT_FEEDBACK","people"),
  /* incidents */
  node("DAMP_INCIDENT","DAMP_INCIDENT","inc"),
  node("MAINT_REQUEST","MAINT_REQUEST","inc"),
  node("INSPECTION","INSPECTION","inc"),
  node("ASB_INCIDENT","ASB_INCIDENT","inc"),
  /* misc */
  node("TENANCY_EVENT","TENANCY_EVENT","misc"),
  node("COMPLIANCE_RECORD","COMPLIANCE_RECORD","misc"),
  node("ENERGY_READING","ENERGY_READING","misc"),
  node("IOT_SENSOR","IOT_SENSOR","misc")
]);

const edges = new vis.DataSet([
  edge("BLOCK","ESTATE","in estate"),
  edge("PROPERTY","BLOCK","in block"),
  edge("TENANT","PROPERTY","occupies"),
  edge("TENANCY_EVENT","PROPERTY","history"),
  edge("RENT_PAYMENT","TENANT","made by"),
  edge("TENANT_FEEDBACK","TENANT","given by"),
  edge("DAMP_INCIDENT","PROPERTY","at"),
  edge("MAINT_REQUEST","PROPERTY","for"),
  edge("INSPECTION","PROPERTY","for"),
  edge("ASB_INCIDENT","PROPERTY","at"),
  edge("COMPLIANCE_RECORD","PROPERTY","for"),
  edge("ENERGY_READING","PROPERTY","for"),
  edge("IOT_SENSOR","PROPERTY","monitors")
]);

/* ---------- Network options ---------- */
const container = document.getElementById("network");
const data = { nodes, edges };
const options = {
  nodes:{
    shape:"box", margin:10, font:{face:"Inter",size:14,color:"#fff"},
    borderWidth:1, widthConstraint:{maximum:140}
  },
  groups:{
    core   :{color:{background:"var(--core)",   border:"var(--core)"}},
    people :{color:{background:"var(--people)", border:"var(--people)"}},
    inc    :{color:{background:"var(--inc)",    border:"var(--inc)"}},
    misc   :{color:{background:"var(--misc)",   border:"var(--misc)"}},
  },
  edges:{
    color:{color:"#64748b"}, smooth:{type:"continuous"}, arrows:{to:{enabled:true,scaleFactor:.7}}
  },
  physics:{enabled:true, stabilization:{iterations:600}, barnesHut:{springLength:120}},
  interaction:{hover:true, tooltipDelay:50}
};

const network = new vis.Network(container, data, options);

/* ---------- toolbar actions ---------- */
document.getElementById("fitBtn").onclick = () => network.fit({animation:true});
document.getElementById("pngBtn").onclick = () =>{
  const url = container.querySelector("canvas").toDataURL("image/png");
  const a = document.createElement("a"); a.href = url; a.download = "housing_er_network.png"; a.click();
};

/* ----- resize observer so legend stays above toolbox icons ----- */
new ResizeObserver(()=>network.redraw()).observe(container);
</script>
</body>
</html>
